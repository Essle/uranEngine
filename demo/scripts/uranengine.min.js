/*

	uranEngine 
	Текущая версия: 1.8.1
	_______________________________

	uranengine.ru
	github.com/Essle/uranEngine

*/

function _object(t){this.type="object",this.name=t,this.id=++lastId,this.data={polygons:{points:[],size:{height:0,width:0},collision:[]},collision:[],offset:{left:0,right:0,top:0,bottom:0},animate:{sprite:null,infinity:!1,animated:!1,getFrame:1,pause:5,update:0,frames:0},angle:0,sprite:null,mouse:!1},this.property={fasten:!1,sprite:null,background:null,health:100,collision:!1,velocity:{x:2,y:2},polygons:[],position:{x:0,y:0},toggle:!0,angle:0,opacity:1,size:{height:0,width:0},data:[],index:1},OBJECTS.push(this),__sortByIndex(OBJECTS)}function __isObjectCollision(t,e){for(var o=!1,i=0;i<OBJECTS.length;++i)if(t!=OBJECTS[i]&&(__isObjectInObject(e,t,OBJECTS[i])?(OBJECTS[i].property.collision&&(o=!0),t.data.collision[OBJECTS[i].id]||(t.data.collision[OBJECTS[i].id]=!0,OBJECTS[i].property.collision||EVENTS.onObjectEnter.run(t,{object:OBJECTS[i]}),there(t)&&there(OBJECTS[i])&&EVENTS.onObjectCollision.run(t,{object:OBJECTS[i]}))):t.data.collision[OBJECTS[i].id]&&(delete t.data.collision[OBJECTS[i].id],OBJECTS[i].property.collision||EVENTS.onObjectLeave.run(t,{object:OBJECTS[i]})),!there(t)))return!0;return o}function __isObjectInObject(t,e,o){var i=__getObjectPositionOffset(e,t);if(i.left>o.data.offset.right||i.right<o.data.offset.left||i.top>o.data.offset.bottom||i.bottom<o.data.offset.top)return!1;for(var n=0;n<e.data.polygons.points.length-1;++n){for(var a=[i.left+e.data.polygons.points[n][0],i.top+e.data.polygons.points[n][1]],s=[i.left+e.data.polygons.points[n+1][0],i.top+e.data.polygons.points[n+1][1]],r=0;r<o.data.polygons.points.length-1;++r){var p=[o.data.offset.left+o.data.polygons.points[r][0],o.data.offset.top+o.data.polygons.points[r][1]],l=[o.data.offset.left+o.data.polygons.points[r+1][0],o.data.offset.top+o.data.polygons.points[r+1][1]];if((p[1]-l[1])*a[0]+(l[0]-p[0])*a[1]+(p[0]*l[1]-l[0]*p[1])===0||(p[1]-l[1])*s[0]+(l[0]-p[0])*s[1]+(p[0]*l[1]-l[0]*p[1])===0||((l[0]-p[0])*(a[1]-p[1])-(l[1]-p[1])*(a[0]-p[0]))*((l[0]-p[0])*(s[1]-p[1])-(l[1]-p[1])*(s[0]-p[0]))<0&&((s[0]-a[0])*(p[1]-a[1])-(s[1]-a[1])*(p[0]-a[0]))*((s[0]-a[0])*(l[1]-a[1])-(s[1]-a[1])*(l[0]-a[0]))<0)return e.data.polygons.collision[o.id]!=r&&(e.data.polygons.collision[o.id]=r,EVENTS.onObjectPolygon.run(e,{object:o,polygon:r})),!0}if(o.isLocated(i.left+e.data.polygons.points[n][0],i.top+e.data.polygons.points[n][1]))return!0}return!1}function __getObjectPositionOffset(t,e){return{left:e.x-t.property.size.width/2,right:e.x+t.property.size.width/2,top:e.y-t.property.size.height/2,bottom:e.y+t.property.size.height/2}}function __updateObjectOffset(t){t.data.offset={left:t.property.position.x-t.property.size.width/2,right:t.property.position.x+t.property.size.width/2,top:t.property.position.y-t.property.size.height/2,bottom:t.property.position.y+t.property.size.height/2}}function __updateObjectPolygons(t){for(var e=[t.data.polygons.size.width/t.property.size.width,t.data.polygons.size.height/t.property.size.height],o=[t.property.size.width/2,t.property.size.height/2],i=Math.sin(t.data.angle),n=Math.cos(t.data.angle),a=[],s=0;s<t.property.polygons.length;++s)a=[t.property.polygons[s][0]/e[0]-o[0],t.property.polygons[s][1]/e[1]-o[1]],t.data.polygons.points[s]=[o[0]+(a[0]*n-a[1]*i)<<0,o[1]+(a[0]*i+a[1]*n)<<0];t.data.polygons.points[t.property.polygons.length]=t.data.polygons.points[0]}function createWorld(t,e,o){window.onload=function(){return WORLD.element=document.getElementById(t),WORLD.element?(WORLD.canvas=WORLD.element.getContext("2d"),e==CONST.FULL_SIZE&&(e=[document.documentElement.clientWidth,document.documentElement.clientHeight],WORLD.element.style.position="absolute",WORLD.element.setAttribute("data-fullsize",!0)),WORLD.element.width=e[0],WORLD.element.height=e[1],WORLD.canvas.textBaseline="hanging",WORLD.canvas.lineWidth=2,WORLD.canvas.strokeStyle="#ff0000",__bindController(),function i(){__renderFrames(i),__updateWorld()}(),void o()):void console.error("Canvas с id `"+t+"` не найден")}}function createObject(t,e){"object"==typeof t&&(e=t,t="Undefined");var o=new _object(t);return e&&o.set(e),o}function selectObjects(t){for(var e=[],o=0;o<OBJECTS.length;++o)(OBJECTS[o].name==t||"undefined"==typeof t)&&e.push(OBJECTS[o]);return e}function createHud(t,e){"object"==typeof t&&(e=t,t="Undefined");var o=new _hud(t);return e&&o.set(e),o}function selectHud(t){for(var e=[],o=0;o<HUD.length;++o)(HUD[o].name==t||"undefined"==typeof t)&&e.push(HUD[o]);return e}function there(t){return"object"!=typeof t||void 0==typeof t.type?!1:"hud"==t.type?-1!=HUD.indexOf(t):"object"==t.type?-1!=OBJECTS.indexOf(t):!1}function findFromId(t){for(var e=OBJECTS.concat(HUD),o=0;o<e.length;++o)if(e[o].id===t)return e[o];return void 0}function cacheSprites(t,e){e?t+="/":(e=t,t="data/sprites/");for(var o=0;o<e.length;++o)WORLD.sprites[e[o]]=new Image,WORLD.sprites[e[o]].src=t+e[o],WORLD.sprites[e[o]].onerror=function(){delete WORLD.sprites[e[o]]}}function cacheSounds(t,e){e?t+="/":(e=t,t="data/sounds/");for(var o=0;o<e.length;++o)WORLD.sounds[e[o]]=new Audio,WORLD.sounds[e[o]].src=t+e[o],WORLD.sounds[e[o]].onerror=function(){delete WORLD.sounds[e[o]]}}function playSound(t){return WORLD.sounds[t]?(WORLD.sounds[t].load(),void WORLD.sounds[t].play()):void console.warn("Звук "+t+" не найден в кэше игры")}function setCursor(t){WORLD.element.style.cursor=t}function drawMap(t){return WORLD.sprites[t]?(WORLD.map={sprite:WORLD.sprites[t],position:[[0,0]]},void(WORLD.map.update=function(){WORLD.canvas.globalAlpha=1;for(var t=0;2>t;++t)if(WORLD.map.position[t]){var e=[WORLD.element.width-WORLD.map.position[t][0],WORLD.element.height-WORLD.map.position[t][1]];if(!(e[0]<=0||e[1]<=0)){var o=e[0]>WORLD.element.width?WORLD.element.width:e[0],i=e[t][1]>WORLD.element.height?WORLD.element.height:e[1];WORLD.canvas.drawImage(WORLD.map.sprite,0,0,o,i,WORLD.map.position[t][0],WORLD.map.position[t][1],o,i)}}})):void console.warn("Спрайт "+t+" не найден в кэше игры")}function moveMap(t,e){if(!WORLD.map)return void __consoleOnce("notdrawmap","Движение карты недопустимо: Не вызвана функция drawMap","warn");if(!WORLD.map.position[1])if(180==t)WORLD.map.position[1]=[WORLD.element.width,0];else if(0===t)WORLD.map.position[1]=[-WORLD.element.width,0];else if(90==t)WORLD.map.position[1]=[0,WORLD.element.height];else{if(270!=t)return void __consoleOnce("invalidmapangle","Движение карты недопустимо: Некорректный угол движения","warn");WORLD.map.position[1]=[0,-WORLD.element.height]}for(var o=e*Math.cos(t*-CONST.RAD)<<0,i=e*Math.sin(t*-CONST.RAD)<<0,n=0;2>n;++n)WORLD.map.position[n][0]+=o,WORLD.map.position[n][1]+=i;for(var n=0;2>n;++n)WORLD.map.position[n][0]+WORLD.element.width<=0?WORLD.map.position[n][0]=WORLD.element.width:WORLD.map.position[n][0]>=WORLD.element.width&&(WORLD.map.position[n][0]=-WORLD.element.width),WORLD.map.position[n][1]+WORLD.element.height<=0?WORLD.map.position[n][1]=WORLD.element.height:WORLD.map.position[n][1]>=WORLD.element.height&&(WORLD.map.position[n][1]=-WORLD.element.height)}function __updateWorld(){WORLD.canvas.clearRect(0,0,WORLD.element.width,WORLD.element.height),WORLD.map&&WORLD.map.update(),WORLD.canvas.beginPath();for(var t=0;t<OBJECTS.length;++t)OBJECTS[t].property.toggle&&EVENTS.onObjectUpdate.run(OBJECTS[t],{object:OBJECTS[t]});for(var t=0;t<OBJECTS.length;++t)OBJECTS[t].isRender()&&(WORLD.canvas.globalAlpha=OBJECTS[t].property.opacity,WORLD.canvas.translate(OBJECTS[t].property.position.x,OBJECTS[t].property.position.y),WORLD.canvas.rotate(OBJECTS[t].data.angle),OBJECTS[t].property.background&&(WORLD.canvas.fillStyle=OBJECTS[t].property.background,WORLD.canvas.fillRect(-OBJECTS[t].property.size.width/2,-OBJECTS[t].property.size.height/2,OBJECTS[t].property.size.width,OBJECTS[t].property.size.height)),OBJECTS[t].data.animate.animated?(WORLD.canvas.drawImage(OBJECTS[t].data.animate.sprite,OBJECTS[t].property.size.width*(OBJECTS[t].data.animate.getFrame-1),0,OBJECTS[t].data.animate.sprite.width/OBJECTS[t].data.animate.frames,OBJECTS[t].data.animate.sprite.height,-OBJECTS[t].property.size.width/2,-OBJECTS[t].property.size.height/2,OBJECTS[t].property.size.width,OBJECTS[t].property.size.height),OBJECTS[t].data.animate.update++,OBJECTS[t].data.animate.update==OBJECTS[t].data.animate.pause&&(OBJECTS[t].data.animate.getFrame==OBJECTS[t].data.animate.frames?OBJECTS[t].data.animate.infinity&&(OBJECTS[t].data.animate.getFrame=1):OBJECTS[t].data.animate.getFrame++,OBJECTS[t].data.animate.update=0)):OBJECTS[t].data.sprite&&WORLD.canvas.drawImage(OBJECTS[t].data.sprite,-OBJECTS[t].property.size.width/2,-OBJECTS[t].property.size.height/2,OBJECTS[t].property.size.width,OBJECTS[t].property.size.height),WORLD.canvas.rotate(-OBJECTS[t].data.angle),WORLD.canvas.translate(-OBJECTS[t].property.position.x,-OBJECTS[t].property.position.y),OBJECTS[t].data.polygons.points.length>2&&CONST.DEBUG&&__renderPolygons(OBJECTS[t]));WORLD.canvas.stroke();for(var t=0;t<HUD.length;++t)HUD[t].property.toggle&&EVENTS.onHudUpdate.run(HUD[t],{hud:HUD[t]});for(var t=0;t<HUD.length;++t)HUD[t].isRender()&&(WORLD.canvas.globalAlpha=HUD[t].property.opacity,WORLD.canvas.translate(HUD[t].data.center.x,HUD[t].data.center.y),WORLD.canvas.rotate(HUD[t].data.angle),HUD[t].property.background&&(WORLD.canvas.fillStyle=HUD[t].property.background,WORLD.canvas.fillRect(-HUD[t].data.size.width/2,-HUD[t].data.size.height/2,HUD[t].data.size.width,HUD[t].data.size.height)),HUD[t].data.sprite&&WORLD.canvas.drawImage(HUD[t].data.sprite,-HUD[t].data.size.width/2,-HUD[t].data.size.height/2,HUD[t].data.size.width,HUD[t].data.size.height),WORLD.canvas.textAlign=HUD[t].property.align,WORLD.canvas.font=HUD[t].property.textStyle+" "+HUD[t].property.textSize+"px "+HUD[t].property.textFont,WORLD.canvas.fillStyle=HUD[t].property.textColor,WORLD.canvas.fillText(HUD[t].property.text,HUD[t].data.offsetText.x,HUD[t].data.offsetText.y),WORLD.canvas.rotate(-HUD[t].data.angle),WORLD.canvas.translate(-HUD[t].data.center.x,-HUD[t].data.center.y),HUD[t].data.polygons.points.length>2&&CONST.DEBUG&&__renderPolygons(HUD[t]));for(var t=0;t<keyHas.length;++t)EVENTS.onKeyHas.run(keyHas[t]);EVENTS.onWorldUpdate.run()}function _event(t){this.key=t,this.callback=[],this.target=[],this.save={params:[],target:[]},EVENTS[t]=this,window[t]=function(e,o){EVENTS[t].init(e,o)}}function _hud(t){this.type="hud",this.name=t,this.id=++lastId,this.data={mouse:!1,center:{x:0,y:0},size:{width:0,height:0},sprite:null,angle:0,offsetText:{x:0,y:0},offset:{left:0,right:0,top:0,bottom:0},polygons:{points:[],local:[]}},this.property={text:"",textColor:"#fff",textSize:14,textFont:"Arial",textStyle:"",textPadding:[0,0,0,0],sprite:null,toggle:!0,align:"left",background:null,angle:0,position:{x:0,y:0},opacity:1,size:{width:"auto",height:"auto"},index:1},HUD.push(this),__sortByIndex(HUD)}function __updateHudData(t,e){"number"==typeof e.width?t.data.size.width=cloneObject(e.width)+t.property.textPadding[3]+t.property.textPadding[1]:"auto"==e.width&&(WORLD.canvas.font=t.property.textStyle+" "+t.property.textSize+"px "+t.property.textFont,t.data.size.width=WORLD.canvas.measureText(t.property.text).width+t.property.textPadding[3]+t.property.textPadding[1]),"number"==typeof e.height?t.data.size.height=cloneObject(e.height)+t.property.textPadding[0]+t.property.textPadding[2]:"auto"==e.height&&(t.data.size.height=t.property.textSize*CONST.FONTHEIGHT+t.property.textPadding[0]+t.property.textPadding[2]);var o=0,i=0,n=0;switch(t.property.align){case"left":o=t.property.position.x,i=t.property.textPadding[3]-t.data.size.width/2,n=t.property.position.x+t.data.size.width/2;break;case"center":o=t.property.position.x-t.data.size.width/2,n=t.property.position.x;break;case"right":o=t.property.position.x-t.data.size.width,i=-t.property.textPadding[3]+t.data.size.width/2,n=t.property.position.x-t.data.size.width/2}t.data.offset={left:o,right:o+t.data.size.width,top:t.property.position.y,bottom:t.property.position.y+t.data.size.height},t.data.center={x:n,y:t.property.position.y+t.data.size.height/2},t.data.offsetText={x:i,y:t.property.textPadding[0]-t.data.size.height/2},t.data.polygons.local=[[0,0],[t.data.size.width,0],[t.data.size.width,t.data.size.height],[0,t.data.size.height]],__updateHudPolygons(t)}function __updateHudPolygons(t){for(var e=Math.sin(t.data.angle),o=Math.cos(t.data.angle),i=[t.data.size.width/2,t.data.size.height/2],n=[],a=0;a<t.data.polygons.local.length;++a)n=[t.data.polygons.local[a][0]-i[0],t.data.polygons.local[a][1]-i[1]],t.data.polygons.points[a]=[i[0]+(n[0]*o-n[1]*e)<<0,i[1]+(n[0]*e+n[1]*o)<<0];t.data.polygons.points[t.data.polygons.local.length]=t.data.polygons.points[0]}function __bindController(){function t(){keyHas=[]}window.addEventListener("blur",t),window.addEventListener("contextmenu",t),document.addEventListener("keydown",function(t){-1==keyHas.indexOf(t.keyCode)&&(keyHas[keyHas.length]=t.keyCode,EVENTS.onKeyDown.run(t.keyCode))}),document.addEventListener("keyup",function(t){-1!=keyHas.indexOf(t.keyCode)&&(keyHas.splice(keyHas.indexOf(t.keyCode),1),EVENTS.onKeyUp.run(t.keyCode))}),WORLD.element.addEventListener("mousemove",function(t){var e={x:t.pageX-WORLD.element.offsetLeft,y:t.pageY-WORLD.element.offsetTop};EVENTS.onMouseMove.run({position:e});for(var o=0;o<OBJECTS.length;++o)OBJECTS[o].isLocated(t.pageX,t.pageY)&&OBJECTS[o].property.toggle?OBJECTS[o].data.mouse||(OBJECTS[o].data.mouse=!0,EVENTS.onMouseEnterObject.run(OBJECTS[o],{position:e})):OBJECTS[o].data.mouse&&(OBJECTS[o].data.mouse=!1,EVENTS.onMouseLeaveObject.run(OBJECTS[o],{position:e}));for(var o=0;o<HUD.length;++o)HUD[o].isLocated(t.pageX,t.pageY)&&HUD[o].property.toggle?HUD[o].data.mouse||(HUD[o].data.mouse=!0,EVENTS.onMouseEnterHud.run(HUD[o],{position:e})):HUD[o].data.mouse&&(HUD[o].data.mouse=!1,EVENTS.onMouseLeaveHud.run(HUD[o],{position:e}))}),WORLD.element.addEventListener("click",function(t){var e={x:t.pageX-WORLD.element.offsetLeft,y:t.pageY-WORLD.element.offsetTop};EVENTS.onMouseClicked.run({position:e});for(var o=0;o<OBJECTS.length;++o)OBJECTS[o].isLocated(t.pageX,t.pageY)&&OBJECTS[o].property.toggle&&EVENTS.onClickedObject.run(OBJECTS[o],{position:e});for(var o=0;o<HUD.length;++o)HUD[o].isLocated(t.pageX,t.pageY)&&HUD[o].property.toggle&&EVENTS.onClickedHud.run(HUD[o],{position:e})}),WORLD.element.addEventListener("mousedown",function(t){EVENTS.onMouseDown.run({position:{x:t.pageX-WORLD.element.offsetLeft,y:t.pageY-WORLD.element.offsetTop}})}),WORLD.element.addEventListener("mouseup",function(t){EVENTS.onMouseUp.run({position:{x:t.pageX-WORLD.element.offsetLeft,y:t.pageY-WORLD.element.offsetTop}})})}function __renderPolygons(t){for(var e=0;e<t.data.polygons.points.length-1;++e)WORLD.canvas.moveTo(t.data.offset.left+t.data.polygons.points[e][0],t.data.offset.top+t.data.polygons.points[e][1]),WORLD.canvas.lineTo(t.data.offset.left+t.data.polygons.points[e+1][0],t.data.offset.top+t.data.polygons.points[e+1][1])}function __isPointInPolygons(t,e,o){for(var i=!1,n=[],a=[],s=0,r=t.data.polygons.points.length-1;s<t.data.polygons.points.length;r=s++)n=[t.data.offset.left+t.data.polygons.points[s][0],t.data.offset.left+t.data.polygons.points[r][0]],a=[t.data.offset.top+t.data.polygons.points[s][1],t.data.offset.top+t.data.polygons.points[r][1]],a[0]>o!=a[1]>o&&e<(n[1]-n[0])*(o-a[0])/(a[1]-a[0])+n[0]&&(i=!i);return i}function __consoleOnce(t,e,o){if(!onceLog[t]){switch(o){case"warn":console.warn(e);break;case"info":console.info(e);break;case"error":console.error(e);break;default:console.log(e)}onceLog[t]=!0}}function __sortByIndex(t){for(var e,o=0;o<t.length;++o)for(var i=0;i<t.length-o;++i)t[o].property.index<t[i].property.index&&(e=t[o],t[o]=t[i],t[i]=e)}function clearObject(t){if("object"!=typeof t)return!1;for(var e in t)delete t[e];for(var e in t.__proto__)t[e]=function(){return t}}function cloneObject(t){if("object"!=typeof t)return t;var e=new t.constructor;for(var o in t)e[o]="object"==typeof t[o]?cloneObject(t[o]):t[o];return e}function random(t,e,o){var i=t-.5+Math.random()*(e-t+1);return o?i:Math.round(i)}function vectorLength(t,e){return Math.sqrt(Math.pow((e.x||e[0])-(t.x||t[0]),2)+Math.pow((e.y||e[1])-(t.y||t[1]),2))}function anglePoint(t,e,o,i){var n=Math.atan2(e-i,o-t)*CONST.DEG;return 0>n?n+360:n}var CONST={FRAMES:60,RAD:Math.PI/180,DEG:180/Math.PI,FONTHEIGHT:.8,DEBUG:!1,FULL_SIZE:"fs"},lastId=0,onceLog=[],OBJECTS=[];_object.prototype={destroy:function(){OBJECTS.splice(OBJECTS.indexOf(this),1),clearObject(this)},set:function(t){if("object"==typeof t.size&&(this.property.size={width:"number"==typeof t.size.width?t.size.width<<0:this.property.size.width,height:"number"==typeof t.size.height?t.size.height<<0:this.property.size.height},__updateObjectOffset(this),this.property.polygons.length?__updateObjectPolygons(this):(this.data.polygons.size=this.property.size,this.property.polygons=[[0,0],[this.property.size.width,0],[this.property.size.width,this.property.size.height],[0,this.property.size.height]],this.data.polygons.points=cloneObject(this.property.polygons),this.data.polygons.points[this.property.polygons.length]=this.data.polygons.points[0])),"object"==typeof t.polygons)if(t.polygons.length<3)console.warn("Количество полигонов не может быть меньше трех");else{this.data.polygons.size={width:0,height:0};for(var e=0;e<t.polygons.length;++e)this.data.polygons.size={width:this.data.polygons.size.width<t.polygons[e][0]?t.polygons[e][0]:this.data.polygons.size.width,height:this.data.polygons.size.height<t.polygons[e][1]?t.polygons[e][1]:this.data.polygons.size.height};this.property.polygons=cloneObject(t.polygons),this.data.polygons.points=cloneObject(t.polygons),this.data.polygons.points[this.property.polygons.length]=this.data.polygons.points[0],0===this.property.size.width&&0===this.property.size.height&&(this.property.size=this.data.polygons.size,__updateObjectOffset(this)),__updateObjectPolygons(this)}if("number"==typeof t.angle&&(t.angle>360?t.angle-=360:t.angle<-360&&(t.angle+=360),this.data.angle=(this.property.angle=t.angle)*-CONST.RAD,__updateObjectPolygons(this)),"string"==typeof t.sprite&&(WORLD.sprites[t.sprite]?(this.property.sprite=t.sprite,this.data.sprite=WORLD.sprites[t.sprite],this.data.animate.animated=!1):console.warn("Спрайт "+t.sprite+" не найден в кэше игры")),"string"==typeof t.background?this.property.background=t.background:null===t.background&&(this.property.background=null),"boolean"==typeof t.collision&&(this.property.collision=t.collision),"boolean"==typeof t.toggle&&(this.property.toggle=t.toggle),"number"==typeof t.opacity&&(this.property.opacity=t.opacity),"boolean"==typeof t.fasten&&(this.property.fasten=t.fasten),"number"==typeof t.index&&(this.property.index=t.index,__sortByIndex(OBJECTS)),"number"==typeof t.health){var o=this.property.health;this.property.health=t.health,this.property.health<=0&&(this.property.health=0,o>0&&EVENTS.onObjectDeath.run(this))}return"object"==typeof t.velocity?this.property.velocity={x:"number"==typeof t.velocity.x?t.velocity.x:this.property.velocity.x,y:"number"==typeof t.velocity.y?t.velocity.y:this.property.velocity.y}:"number"==typeof t.velocity&&(this.property.velocity={x:t.velocity,y:t.velocity}),"object"==typeof t.position&&(this.property.position={x:"number"==typeof t.position.x?t.position.x<0&&!t.position.stuck?WORLD.element.width+t.position.x<<0:t.position.x<<0:this.property.position.x,y:"number"==typeof t.position.y?t.position.y<0&&!t.position.stuck?WORLD.element.height+t.position.y<<0:t.position.y<<0:this.property.position.y},__updateObjectOffset(this)),this},get:function(t){return cloneObject(this.property[t])},clone:function(){return new _object(this.name).set(this.property)},onMap:function(){return!(this.data.offset.right<0||this.data.offset.left>WORLD.element.width||this.data.offset.bottom<0||this.data.offset.top>WORLD.element.height)},isRender:function(){return this.onMap()&&this.property.size.width>0&&this.property.size.height>0&&this.property.toggle&&this.property.opacity>0},giveDamage:function(t,e){return this.property.health>0&&(e||(e=t,t=null),this.property.health-=e,this.property.health<=0&&(this.property.health=0,EVENTS.onObjectDeath.run(this,{object:t}))),this},setData:function(t,e){return"undefined"==typeof e?delete this.property.data[t]:this.property.data[t]=e,this},getData:function(t){return this.property.data[t]},animate:function(t,e,o,i){return WORLD.sprites[t]?this.data.animate={sprite:WORLD.sprites[t],infinity:"boolean"==typeof o?o:i,animated:!0,getFrame:1,pause:"number"==typeof o?o:this.data.animate.pause,update:0,frames:e}:console.warn("Спрайт "+t+" не найден в кэше игры"),this},move:function(t){var e={x:this.property.position.x+this.property.velocity.x*Math.cos(t*-CONST.RAD)<<0,y:this.property.position.y+this.property.velocity.y*Math.sin(t*-CONST.RAD)<<0,stuck:!0};if(this.property.fasten)for(var o=__getObjectPositionOffset(this,e),i=0;i<this.data.polygons.points.length;++i)if(o.left+this.data.polygons.points[i][0]<0||o.left+this.data.polygons.points[i][0]>WORLD.element.width||o.top+this.data.polygons.points[i][1]<0||o.top+this.data.polygons.points[i][1]>WORLD.element.height)return this;if(this.property.toggle){if(__isObjectCollision(this,e))return this;if(!there(this))return void 0}return this.set({position:e}),EVENTS.onObjectMove.run(this,{position:e}),this},moveTo:function(t,e){return this.move(anglePoint(this.property.position.x,this.property.position.y,t,e)),this},isLocated:function(t,e){return __isPointInPolygons(this,t,e)}};var WORLD={canvas:null,element:null,sounds:[],sprites:[],map:null},EVENTLIST=["onObjectUpdate","onObjectMove","onObjectCollision","onObjectEnter","onObjectPolygon","onObjectLeave","onObjectDeath","onHudUpdate","onWorldUpdate","onKeyHas","onKeyDown","onKeyUp","onMouseMove","onMouseDown","onMouseUp","onMouseClicked","onMouseEnterObject","onMouseLeaveObject","onClickedObject","onMouseEnterHud","onMouseLeaveHud","onClickedHud"],EVENTS=[];_event.prototype={init:function(t,e){e||(e=t,t=null),this.callback.push(e),this.target.push(t);for(var o=0;o<this.save.target.length;++o)this.run(this.save.target[o],this.save.params[o]),delete this.save.target[o],delete this.save.params[o]},run:function(t,e){if(!this.callback.length)return this.save.params.push(e),void this.save.target.push(t);if(e)for(var o=0;o<this.callback.length;++o)this.target[o]!==t&&this.target[o]!==t.name&&this.target[o]||this.callback[o].apply(t,[e]);else for(var o=0;o<this.callback.length;++o)this.callback[o](t)}};for(var i=0;i<EVENTLIST.length;++i)new _event(EVENTLIST[i]);var HUD=[];_hud.prototype={destroy:function(){HUD.splice(HUD.indexOf(this),1),clearObject(this)},set:function(t){return"string"==typeof t.text&&(this.property.text=t.text),"string"==typeof t.textColor&&(this.property.textColor=t.textColor),"number"==typeof t.textSize&&(this.property.textSize=t.textSize),"string"==typeof t.textFont&&(this.property.textFont=t.textFont),"string"==typeof t.textStyle&&(this.property.textStyle=t.textStyle),"boolean"==typeof t.toggle&&(this.property.toggle=t.toggle),"number"==typeof t.opacity&&(this.property.opacity=t.opacity),"number"==typeof t.index&&(this.property.index=t.index,__sortByIndex(HUD)),"string"==typeof t.background?this.property.background=t.background:null===t.background&&(this.property.background=null),"string"==typeof t.sprite?WORLD.sprites[t.sprite]?(this.property.sprite=t.sprite,this.data.sprite=WORLD.sprites[t.sprite]):console.warn("Спрайт "+t.sprite+" не найден в кэше игры"):null===t.sprite&&(this.property.sprite=null,this.data.sprite=null),"object"==typeof t.textPadding&&(4!=t.textPadding.length?console.warn("Неверный формат отступов текста"):this.property.textPadding=t.textPadding),"number"==typeof t.angle&&(t.angle>360?t.angle-=360:t.angle<-360&&(t.angle+=360),this.data.angle=(this.property.angle=t.angle)*-CONST.RAD),"string"==typeof t.align&&("left"!=t.align&&"center"!=t.align&&"right"!=t.align?console.warn("Неверный тип позиционирования HUD"):this.property.align=t.align),"object"==typeof t.position&&(this.property.position={x:"number"==typeof t.position.x?t.position.x<0?WORLD.element.width+t.position.x<<0:t.position.x<<0:this.property.position.x,y:"number"==typeof t.position.y?t.position.y<0?WORLD.element.height+t.position.y<<0:t.position.y<<0:this.property.position.y}),"object"==typeof t.size&&(this.property.size={width:"number"==typeof t.size.width?t.size.width<<0:"auto"==t.size.width?"auto":this.property.size.width,height:"number"==typeof t.size.height?t.size.height<<0:"auto"==t.size.height?"auto":this.property.size.height}),__updateHudData(this,this.property.size),this},onMap:function(){return!(this.data.offset.right<0||this.data.offset.left>WORLD.element.width||this.data.offset.bottom<0||this.data.offset.top>WORLD.element.height)},isRender:function(){return this.onMap()&&this.data.size.width>0&&this.data.size.height>0&&this.property.toggle&&this.property.opacity>0},get:function(t){return cloneObject(this.property[t])},clone:function(){return new _hud(this.name).set(this.property)},isLocated:function(t,e){return __isPointInPolygons(this,t,e)}};var KEYS={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,CAPSLOCK:20,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,NUMBER:{0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57},F:{1:112,2:113,3:114,4:115,5:116,6:117,7:118,8:119,9:120,10:121,11:122,12:123},LETTER:{a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90}},keyHas=[];window.__renderFrames=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/CONST.FRAMES)}}();